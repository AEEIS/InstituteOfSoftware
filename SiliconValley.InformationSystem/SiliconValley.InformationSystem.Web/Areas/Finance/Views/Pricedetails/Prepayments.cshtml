
@{
    ViewBag.Title = "Prepayments";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div>
    <table class="layui-hide" id="test" lay-filter="test"></table>
</div>
<h2>Prepayments</h2>
@section script{}
<script>

    layui.use(['table', 'layer', 'tree', 'form'], function () {
        var table = layui.table;
        var layer = layui.layer;
        var form = layui.form;

        //表格渲染
        table.render({
            elem: '#test'
            , url: '/Finance/Pricedetails/Expenseentrys'
            , toolbar: '#toolbarDemo'
            , id: 'idTest'
            , page: true
            , cellMinWidth: 80 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
            , cols: [[
                { type: 'radio' }
                , { field: 'studentid', title: '学号', sort: true }
                , { field: 'name', title: '姓名' }
                , { field: 'IDnumber', title: '身份证号 ' }
                , { field: 'Amountofmoney', title: '金额 ' }

                , {
                    field: 'OddNumbers', title: '单号', templet: function (c) {
                        if (c.OddNumbers == null) {
                            return "待审核入账";
                        }
                        return c.OddNumbers;
                    }
                }
                , {
                    field: 'AddDate', title: '缴费时间', templet: function (c) {
                        return getFDate(c.AddDate);
                    }
                }

                , { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 100 }
            ]]
            , page: true
            , limit: 15
            , limits: [15, 18, 20]
        });


        //查询功能
        form.on('submit(demo2)', function (data) {
            var x = data.field;
            table.reload('idTest', {
                where: {
                    StudentID: x.StudentID,
                    Name: x.Name,
                    IsaDopt: x.IsaDopt,
                    OddNumbers: x.OddNumbers
                }, page: {
                    curr: 1
                }
            });
            return false;
        });

        //监听操作按钮
        table.on('tool(test)', function (obj) { //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
            var data = obj.data; //获得当前行数据
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr; //获得当前行 tr 的DOM对象

            if (layEvent === 'process') { //查看
                console.log(data);
                layer.open({
                    type: 2,
                    content: "/Finance/Pricedetails/Entryreview/" + data.id + "?Passornot=" + data.Passornot + "&studentid=" + data.studentid + "&OddNumbers=" + data.OddNumbers
                    , area: ['800px', '600px']
                    , title: "入账审核"
                    , end: function () { table.reload('idTest'); }
                    , shade: 0.3
                    , anim: 1


                });

            }

        });


    });

</script>