
@{
    ViewBag.Title = "MyFollwingInfoIndex";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .inputCss1
    {
        height: 38px;
        line-height: 1.3;
        line-height: 38px;
        border-width: 1px;
        background-color: #fff;
        border-radius: 2px;
        width: 150px;
        border-radius: 5px;
    }
    .demo-class2
    {
        width: 280px;
        text-align: center;
    }

    .demo-class2 .layui-layer-btn a
        {
            background: #009688;
            color: #fff;
            border: 0;
            margin-left: -8px;
            margin-top: -10px;
        }

    body .demo-class2 .layui-layer-title
    {
        background: #009688;
        color: #fff;
        border: none;
    }

    li
    {
        cursor: pointer;
    }

    body .demo-class .layui-layer-title
    {
        background: #009688;
        color: #fff;
        border: none;
    }

    .layui-colla-title
    {
        position: relative;
        padding: 0 15px 0 35px;
        color: #333;
        background-color: #f2f2f2;
        cursor: pointer;
        font-size: 14px;
        overflow: hidden;
        height: 15px;
        line-height: 15px;
    }        
</style>

 

<div class="layui-collapse" lay-accordion>
    <div class="layui-colla-item">
        <h2 class="layui-colla-title">数据查询</h2>
        <div class="layui-colla-content">
            <form class="layui-form">
                <div class="layui-row">
                    <div class="layui-col-sm2">
                        <label class="spanCss2">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 名:</label>
                        <input name="findNamevalue" id="name" class="inputCss1" />
                    </div>
                    <div class="layui-col-sm2">
                        <label class="spanCss2">联系电话:</label>
                        <input name="findPhonevalue" id="phone" class="inputCss1" />
                    </div>
                    <div class="layui-col-sm2">
                        <label class="spanCss2">开始时间:</label>
                        <input name="findStartvalue" id="staTime" class="inputCss1" />
                    </div>
                    <div class="layui-col-sm2">
                        <label class="spanCss2">结束时间:</label>
                        <div style="display: inline-block;width:150px;">
                            <input name="findEndvalue" id="endTime" class="inputCss1" />
                        </div>
                    </div>

                    <div class="layui-col-sm2">
                         <button type="button" class="layui-btn" onclick="Query()">查询</button>
                    </div>
                </div>                
            </form>
        </div>
    </div>

</div>

<table id="follwing_form" class="layui-form" lay-filter="follwing_form"> </table>
<script type="text/html" id="toolbarDemo1">
    <div class="layui-btn-container">         
        <button class="layui-btn layui-btn-sm" onclick="ZhuceClass()"> <i class="layui-icon">&#xe714;</i> 注册学号</button>
    </div>
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="add">添加跟踪信息</a>
    <a class="layui-btn layui-btn-xs" lay-event="edi">编辑跟踪信息</a>
    <a class="layui-btn layui-btn-xs" lay-event="ser">查询跟踪信息</a>
</script>

<script>

    var indexs;
    //这是获取到多个学生的数据显示方法
    function StudentShow(url, mytitle, myskin, mycloseBtn) {
        layui.use('layer', function () {
            var layer = layui.layer;
            layer.open({
                type: 2,
                content: url
                , area: ['1000px', '670px'],
                title: mytitle
                , shade: 0.8
                , anim: 4
                , skin: myskin
                , closeBtn: mycloseBtn
            });
        });
    }
    //转换时间的方法
    function TimeChange(newtime) {
        if (newtime == null)
            return "";
        var date = new Date(parseInt(newtime.slice(6)));
        var year = date.getFullYear();
        var month = date.getMonth();
        if ((month + 1) < 10) {
            month = "0" + Number(month + 1);
        } else {
            month = Number(month + 1);
        }
        var day = date.getDate();
        if (day < 10) {
            day = "0" + day;
        }
        var result = year + '-' + month + '-' + day;
        return result;
    }
    layui.use(['table', 'layer','element','laydate'], function () {
        var table = layui.table;
        var layer = layui.layer;
        var laydate = layui.laydate;
        laydate.render({
            elem: '#staTime'
            , trigger: 'click'
        });
        laydate.render({
            elem: '#endTime'
            , trigger: 'click'
        });
        var element = layui.element;
        table.render({
            elem: '#follwing_form'
            , url: '/Market/FollwingInfo/GetTableData'
            , toolbar: '#toolbarDemo1'
            , cols: [[
                { type: 'checkbox' }
                , { field: 'StuName', title: '姓名' }
                , { field: 'StuSex', title: '性别'}
                , { field: 'Stuphone', title: '联系电话' }
                //, { field: 'stuinfomation', title: '信息来源' }
                //, { field: 'StuisGoto', title: '是否上门', templet: function (res) { if (res.StuisGoto == false || res.StuisGoto == null) { return "未上门"; } else { return "已上门"; } } }
                //, { field: 'StatusName', title: '学生状态' }
                //, { field: 'StuEducational', title: '学历' }
                //, { field: 'empName', title: '备案人' }
                //, { field: 'RegionName', title: '区域' }
                , { field: 'BeanDate', title: '分量日期', templet: function (res) { return TimeChange(res.BeanDate); } }
                , { fixed: 'right', title: '操作', toolbar: '#barDemo', width: 350 }
            ]]
            , page: true
            , limits: [10,20, 40, 50, 60, 80, 100]
            , limit: 10
        });

        //监听行工具事件
        table.on('tool(follwing_form)', function (obj) {
            var data = obj.data;
 
            if (obj.event === 'edi') {
                layer.open({
                    type: 2,
                    content: '/Market/FollwingInfo/EditView/' + data.Id
                    , area: ['1000px', '680px'],
                    title: '编辑跟踪页面'
                    , shade: 0.8
                    , anim: 4
                    , skin: 'demo-class2'
                });            
                
            } else if (obj.event === 'add') {
                //打开跟踪添加页面
                layer.open({
                    type: 2,
                    content: '/Market/FollwingInfo/AddFollwingInfo/' + data.Id
                    , area: ['800px', '580px'],
                    title: '添加跟踪页面'
                    , shade: 0.8
                    , anim: 4
                    , skin: 'demo-class2'
                });
            } else if (obj.event === 'ser') {
                //查看跟踪信息
                layer.open({
                    type: 2,
                    content: '/Market/Consult/FollwingInfoView/' + data.Id
                    , area: ['1000px', '750px']
                    , title: '跟踪信息页面'
                    , shade: 0.8
                    , anim: 4
                    , skin: 'demo-class2'
                });
            }
        });
    });
    function Query() {
        layui.use('table', function () {
            var table = layui.table;

            table.reload('follwing_form', {
                url: '/Market/FollwingInfo/GetTableData'
                , where: { "name": $("#name").val(), "phone": $("#phone").val(), "staTime": $("#staTime").val(), "endTime": $("#endTime").val() }
            });
        });
         
    }

    //注册学生学号
    function ZhuceClass() {
        layui.use(['table', 'layer'], function () {
            var table = layui.table;
            var layer = layui.layer;
            var checkStatus = table.checkStatus('follwing_form');
            if (checkStatus.data.length <= 0) {
                layer.msg('请选择学生数据', { icon: 2, shade: 0.8 });
            } else {
                var ids = "";
                for (var i = 0; i < checkStatus.data.length; i++) {
                    ids = ids + checkStatus.data[i].Id + ",";
                }
                layer.open({
                    type: 2
                    , content: '/Market/StudentDataKeep/Registeredstudentnumber/' + ids
                    , area: ['800px', '420px']
                    , title: '注册学号页面'
                    , shade: 0.8
                    , anim: 4
                    , skin: 'demo-class'
                });
            }
        });
    }
</script>

