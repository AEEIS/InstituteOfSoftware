
@{
    Layout = null;
}

<!DOCTYPE html>
@model SiliconValley.InformationSystem.Entity.MyEntity.NetClientRecord
@using SiliconValley.InformationSystem.Entity.MyEntity;
<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>EditCallbackInfo</title>
    <link href="~/Scripts/layui/css/layui.css" rel="stylesheet" />

    <script src="~/Scripts/jquery-3.3.1.min.js"></script>
    <script src="~/Scripts/layui/layui.js"></script>
    <style>
        #but1 {
            position: absolute;
            top: 13%;
            left: 35%;
            width: 36px;
            height: 36px;
            text-align: center;
            line-height: 36px;
        }

            #but1:hover {
                background-color: aqua;
            }

        #Nation {
            width: 100px;
        }

        .linu {
            height: 120px;
        }
    </style>

</head>
<body>
    <div>
        <form class="layui-form" action="" lay-filter="formtest">
            <div class="layui-container">
                <input id="Id" name="Id" type="hidden" value="@ViewBag.Id" />
                <div class="layui-row layui-form-item">

                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <label class="layui-form-label">姓名:</label>
                        <div class="layui-input-inline">
                            <input type="text" name="StuName" id="StuName" class="layui-input" style="border:0px" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <label class="layui-form-label">性别:</label>
                        <div class="layui-input-block">
                            <input type="text" name="StuSex" id="StuSex" class="layui-input" style="border:0px" readonly="readonly">
                        </div>
                    </div>

                </div>
                <div class="layui-row layui-form-item">
                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <label class="layui-form-label">联系电话:</label>
                        <div class="layui-input-block">
                            <input type="text" name="StuPhone" id="StuPhone" class="layui-input" style="border:0px" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                        <label class="layui-form-label">备案人:</label>
                        <div class="layui-input-block">
                            <input type="text" name="SprEmp" id="SprEmp" class="layui-input" style="border:0px" readonly="readonly">
                        </div>

                    </div>
                </div>
                    <div class="layui-row layui-form-item">
                    
                        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">

                            <label class="layui-form-label">回访次数:</label>
                            <div class="layui-input-block">
                                <input type="text" class="layui-input" readonly="readonly" style="border:0px" value="@ViewBag.Number" />
                            </div>
                        </div>
                        <div class="layui-col-xs6 layui-col-sm6 layui-col-md6">
                            <input type="hidden" id="MarketTeaId" name="MarketTeaId" class="layui-input" />
                            <label class="layui-form-label" style="margin-left:-60px;width:140px;">市场对接老师:</label>
                            <div class="layui-input-block">
                                <input type="text" id="channeltea" name="channeltea" class="layui-input" style="width:250px;" readonly="readonly" />
                                <i class="layui-icon layui-icon-search" id="iconbtn" style="font-size: 25px; color:lightseagreen;float:left;margin:-28px 250px;"></i>
                            </div>
                        </div>

                    </div>

                </div>

</form>
        <div class="layui-tab">
            <ul class="layui-tab-title">
                @{
                    List<NetClientRecord> list = ViewBag.ncrlist as List<NetClientRecord>;
                    int i = 1;
                    if (list.Count > 0)
                    {
                        foreach (var item in list)
                        {
                            //if (i == 1)
                            //{
                            <li id=@i class="layui-this">第<span>@i</span>次跟踪</li>
                            //}
                            //else
                            //{
                            // <li id="@item.Id">第<span>@i</span>次跟踪</li>
                            //}
                            i++;
                        }
                    }
                    else
                    {
                        <li class="layui-this">系统温馨提示</li>
                    }
                }
            </ul>
            <div class="layui-tab-content">
                @{
                    if (list.Count > 0)
                    {
                        <form class="layui-form" id="myform" lay-filter="myform">
                            <div class="layui-tab-item layui-show">
                                <div class="layui-row layui-form-item">
                                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
                                        <input type="hidden" id="F_Id" name="F_Id" value="@list[0].Id" />
                                        <label class="layui-form-label">跟踪日期:</label>
                                        <div class="layui-input-block">
                                            <input class="layui-input" id="NetClientDate" name="NetClientDate" disabled="disabled" value="@list[0].NetClientDate" />
                                        </div>
                                    </div>
                                </div>
                                <div class="layui-row layui-form-item">
                                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
                                        <label class="LableCss1">学生等级:</label>
                                        <div class="layui-input-block">
                                            <select name="Grade" id="Grade">
                                                @{
                                                    if (list[0].Grade.Contains("A"))
                                                    {
                                                        <option value="A" selected="selected">A</option>
                                                        <option value="B">B</option>
                                                        <option value="C">C</option>
                                                        <option value="D">D</option>
                                                    }
                                                    else if (list[0].Grade.Contains("B"))
                                                    {
                                                        <option value="A">A</option>
                                                        <option value="B" selected="selected">B</option>
                                                        <option value="C">C</option>
                                                        <option value="D">D</option>
                                                    }
                                                    else if (list[0].Grade.Contains("C"))
                                                    {
                                                        <option value="A">A</option>
                                                        <option value="B">B</option>
                                                        <option value="C" selected="selected">C</option>
                                                        <option value="D">D</option>
                                                    }
                                                    else if (list[0].Grade.Contains("D"))
                                                    {
                                                        <option value="A">A</option>
                                                        <option value="B">B</option>
                                                        <option value="C">C</option>
                                                        <option value="D" selected="selected">D</option>
                                                    }
                                                }
                                            </select>

                                        </div>
                                    </div>
                                </div>
                                <div class="layui-row layui-form-item">
                                    <div class="layui-col-xs12 layui-col-sm12 layui-col-md12">
                                        <label class="layui-form-label">跟踪情况:</label>
                                        <div class="layui-input-block">
                                            <textarea class="layui-input TextAreCss1" id="My_TailAfterSituation" name="My_TailAfterSituation">
                                                         @list[0].CallBackCase 
                                                    </textarea>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </form>
                    }
                    else
                    {
                        <div class="layui-tab-item layui-show">
                            <h3>
                                该学生还没有跟踪信息哟!!!
                            </h3>
                        </div>
                    }
                }
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit="" lay-filter="demo1" style="margin-left:300px;">立即提交</button>
                <button class="layui-btn " id="btnclose1">关闭</button>
            </div>
        </div>
    </div>

    <script>
        $(function () {
            loadnetinfo();// 初始化编辑数据加载
        });
        function loadnetinfo() {
            var id = $("#Id").val();
            console.log(id);
            $.get("/Market/NetClientRecord/GetCallbackInfoById/" + id, function (data) {
                layui.use(['layer', 'form', 'table'], function () {
                    var form = layui.form;
                    form.val("formtest", data);

                });
            })
        }

        function GetEmpData(Itemnames) {
            $("#MarketTeaId").val(Itemnames.empid);
            $("#channeltea").val(Itemnames.empname);
            console.log("返回的：" + Itemnames.empid + "," + Itemnames.empname);
            console.log("市场老师编号：" + $("#MarketTeaId").val());
            console.log("市场老师名称：" + $("#channeltea").val());
         
        }

        layui.use(['form', 'layedit', 'laydate'], function () {
            var form = layui.form
                , layer = layui.layer
                , layedit = layui.layedit
                , laydate = layui.laydate;

            //市场对接老师选择
            $("#iconbtn").click(function () {
                console.log("图标点击");
                    layer.open({
                        type: 2
                        , area: ["500px", "400px"]
                        , title: "选择员工"
                        , content: '/Market/NetClientRecord/SelectChannelemp' 
                        , anim: 2
                    });
            });

            //日期验证
            laydate.render({
                elem: '#NetClientDate',
            });

            //添加提交
            form.on('submit(demo1)', function (data) {
                console.log('添加提交：' + data.field.Id);
                $.post("/Market/NetClientRecord/EditCallbackInfo", data.field, function (data) {
                    if (data.Success) {
                        layer.alert("编辑成功!", { icon: 1 }, function () {
                            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                            parent.layui.table.reload('mynetinfo');
                            parent.layer.close(index);

                        });
                    } else {
                        layer.alert("编辑失败!");
                    }
                });
                return false;
            });


            //关闭添加页面
            $("#btnclose1").click(function () {
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            });

        });
    </script>
</body>
</html>
