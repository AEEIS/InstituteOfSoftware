
@{
    ViewBag.Title = "TeachersInfo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


@section style{

    <link href="~/Scripts/vendor/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Scripts/layui/css/layui.css" rel="stylesheet" />
    <style>
        body .demo-class .layui-layer-title {
            background: #009688;
            color: #fff;
            border: none;
        }
    </style>

}



    <div>


        <div style=" width:500px; display:inline-block;">

            <!-- Single button -->
            <label>专业：</label>
            <div class="btn-group layui-container" style="width:120px;">

                <button type="button" class="btn btn-default dropdown-toggle" majorid="0" id="selectMajor" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    选择专业 <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" id="majorlist">
                    <li><a href="#" majorid="0">不限</a></li>
                    @{
                        foreach (var item in ViewBag.majors)
                        {
                            <li><a href="javascript:void(0);" majorid="@item.Id">@item.SpecialtyName</a></li>
                        }
                    }

                </ul>
            </div>


            <label>阶段：</label>
            <div class="btn-group layui-container" style="width:120px;">

                <button type="button" class="btn btn-default dropdown-toggle" id="selectGrand" grandid="0" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    选择阶段 <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" id="grandlist">
                    <li><a href="#" grandid="0">不限</a></li>
                    @{
                        foreach (var item in ViewBag.grands)
                        {
                            <li><a href="javascript:void(0);" grandid="@item.Id">@item.GrandName</a></li>
                        }
                    }

                </ul>
            </div>

            <button id="serchBtn1" class="layui-btn layui-btn-radius layui-btn-primary">查询</button>
        </div>

        <div style="display:inline-block;width:500px;" class="form-inline">

            <div class="form-group">
                <input type="text" class="form-control" id="name" placeholder="输入姓名">
            </div>

            <div class="form-group">
                <input type="tel" class="form-control" id="phone" lay-verify="phone" placeholder="电话">
            </div>

            <button id="serchBtn2" class="layui-btn layui-btn-radius layui-btn-primary">查询</button>

        </div>

        @*<div id="tablelist">
            @{
                foreach (var item in ViewBag.majors)
                {
            <div>
                <h1 style="text-align:center; background-color:#23cc36 " >@item.SpecialtyName</h1>
                @{

                    foreach (var item1 in ViewBag.grands)
                    {
                <div style="margin-left:20px;">
                    <h3 style="text-align:center; background-color:#70cc75;" >@item1.GrandName</h3>



                </div>
                    }

                }



            </div>
                }
            }

        </div>*@

        <table class="layui-hide tablelist" id="teacherlist" lay-filter="teacherlist_filter"></table>

        <script type="text/html" id="topBar">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-sm" lay-event="EditMajorAdnGrand">专业 / 阶段</button>
              
            </div>
        </script>

        <script type="text/html" id="editBar">
            <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="detail">详情</a>
            <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="editgoodmajor">擅长的课程</a>
        </script>


    </div>

@section script{
    <script src="~/Areas/Teaching/Scripts/Ajax.js"></script>

    <script src="~/Areas/Teaching/Scripts/Teacheroptioner.js"></script>
    <script src="~/Scripts/vendor/bootstrap/bootstrap.min.js"></script>
    <script src="~/Areas/Teaching/Scripts/util.js"></script>
    <script src="~/Areas/Teaching/Scripts/md5.js"></script>
    <script>


        layui.use(['table', 'layer', 'form', 'element'], function () {
            var table = layui.table;
            var layer = layui.layer;
            var form = layui.form;
            var element = layui.element;

            //var index = layer.load(0, { shade: false }); //0代表加载的风格，支持0-2



            function render(elem, topBar , major, grand) {
                table.render({
                    elem: elem
                    , id: 'Teacherlist'
                    , toolbar: topBar
                    , shade: 3
                    , url: '/Teaching/Teacher/TeacherData?major=' + major + "&grand=" + grand
                    , cellMinWidth: 100 //全局定义常规单元格的最小宽度，layui 2.2.1 新增
                    , cols: [[
                        { type: 'checkbox', fixed: 'left' }
                        , { field: 'TeacherID', title: 'ID', sort: true, hide: true }
                        , { field: 'TeacherName', title: '姓名' }
                        , { field: 'EmployeeId', title: '员工编号' }
                        , {
                            field: 'Sex', title: '性别', templet: function (data) {

                                if (data.toString() == 0) {
                                    return '女';
                                }

                                return '男';

                            }
                        }
                        , { field: 'WorkExperience', title: '工作经验', sort: true }
                        , { field: 'ProjectExperience', title: '项目经验', sort: true }
                        , { field: 'TeachingExperience', title: '教学经验', sort: true }
                        , { field: 'AttendClassStyle', title: '上课风格', sort: true }
                        , { field: 'right', title: '操作', toolbar: '#editBar', width: 250 }
                    ]]
                    , page: true
                });
            }


            render("#teacherlist" , "#topBar",0,0);

            //$(".tablelist").each(function (index, elem) {

            //   var tableid = $(this).attr("id");


            //    console.log(index+"...................");

            //    var major = $(this).attr("majorid");
            //    var grand = $(this).attr("grandid");
                
            //    render("#" + tableid, "#topBar",major, grand);

            //});


            function openTeacherMajorAndGrand(teacherid,title) {

                layer.open({
                    type: 2,
                    skin: "demo-class",
                    btn: ['关闭'],
                    area: ["1000px", "500px"],
                    title: title,
                    content: "/Teaching/Teacher/EditMajorAndGrandView/" + teacherid,
                    end: function () {

                        table.reload('Teacherlist', {

                        });
                    }

                });
            }
            //头工具栏事件
            table.on('toolbar(teacherlist_filter)', function (obj) {

                var checkStatus = table.checkStatus(obj.config.id);

                switch (obj.event) {

                    case 'EditMajorAdnGrand':

                        if (checkStatus.data.length > 0) {

                            openTeacherMajorAndGrand(checkStatus.data[0].TeacherID, " 教员 (" + checkStatus.data[0].TeacherName + " )专业-阶段");
                            

                        } else {

                            layer.msg("请选择员工");
                        }

                        break;

                    case 'Add':


                        layer.open({
                            type: 2
                            , area: ["600px", "300px"],
                            shade: [0],
                            title: "选择员工",
                            btn: ['确定', '关闭'],
                            content: '/Teaching/Teacher/Teacherlist'
                            //, end: function () { table.reload('idTest', {}); }
                            , yes: function (index) {
                                //当点击‘确定’按钮的时候，获取弹出层返回的值
                                var res = window["layui-layer-iframe" + index].callbackdata();
                                console.log(res);

                                //打印返回的值，看是否有我们想返回的值。
                                if (res) {

                                    //// 获取员工ID
                                    var empid = res.data[0].Number;

                                    layer.close(index);

                                    layer.open({
                                        type: 2,
                                        area: ["900px", "800px"],
                                        shade: [0],
                                        title: "添加教员",
                                        content: '/Teaching/Teacher/AddTeacher?empid=' + empid,
                                        end: function () {

                                            table.reload('Teacherlist', {

                                            });

                                        }
                                    });

                                    //layer.open({
                                    //    content: 'test'
                                    //});


                                } else {
                                    layer.msg('请选择员工', { icon: 0 });
                                }

                                layer.close(index);
                            }

                        });

                        break;
                };
            });


            //监听行工具事件
            table.on('tool(teacherlist_filter)', function (obj) {
                var data = obj.data;
                var id = obj.data.TeacherID;
                var name = obj.data.TeacherName;

                console.log(id);

                //console.log(obj)
                if (obj.event === 'detail') {
                    layer.open({
                        skin: "demo-class",
                        type: 2,
                        area: ["1300px", "1000px"],
                        content: "/Teaching/Teacher/TeacherDetailView/" + id,
                        end: function () {


                        }

                    });
                } else if (obj.event === 'edit') {
                    layer.open({
                        skin: "demo-class",
                        type: 2,
                        cancel: function () {
                        },
                        area: ["1200px", "1000px"],
                        content: "/Teaching/Teacher/Operating/" + id,
                        end: function () {

                            table.reload('Teacherlist', {

                            });
                        }
                    });
                } else if (obj.event === 'editgoodmajor') {


                    layer.open({
                        type: 2,
                        skin: "demo-class",
                        btn: ['关闭', "给教员添加专业"],
                        area: ["1000px", "500px"],
                        title: "教员 ("+ name +") 擅长的课程",
                        content: "/Teaching/Teacher/goodmajor/" + id,
                        end: function () {

                            table.reload('Teacherlist', {

                            });
                        },
                        btn2: function () {


                            openTeacherMajorAndGrand(id, "教员 (" + name+" )专业-阶段");

                        }


                    });
                }

            });


            $("#majorlist li a").click(function () {

                var major = $(this).text();

                $("#selectMajor")[0].innerHTML = major + " <span class='caret'></span>";

                var majorid = $(this).attr("majorid");
                $("#selectMajor").attr("majorid", majorid);

            });

            $("#grandlist li a").click(function () {

                var grand = $(this).text();

                $("#selectGrand")[0].innerHTML = grand + " <span class='caret'></span>";

                var grandid = $(this).attr("grandid");
                $("#selectGrand").attr("grandid", grandid);
            });

            $("#serchBtn1").click(function () {

                //获取 专业ID
                var majorid = $("#selectMajor").attr("majorid");

                //获取阶段ID
                var grandid = $("#selectGrand").attr("grandid");

                //发送请求
                table.reload('Teacherlist', {
                    url: '/Teaching/Teacher/GetTeacherByMajorOrGrand'
                    , where: {

                        majorid: majorid,
                        grandid: grandid,

                    } //设定异步数据接口的额外参数
                    //,height: 300
                });

            });

            $("#serchBtn2").click(function () {

                //获取姓名 和 电话
                var name = $("#name").val();
                var phone = $("#phone").val();

                table.reload('Teacherlist', {
                    url: '/Teaching/Teacher/BrushSelectionTeacher'
                    , where: {

                        name: name,
                        phone: phone,

                    } //设定异步数据接口的额外参数
                    //,height: 300
                });

            });


            //监听跳转查询事件
            var queryMajor = getQueryVariable("major");

            console.log(queryMajor +'.....................');

            if (queryMajor == undefined || queryMajor == null || queryMajor == false) {

                

            } else {
                var querymajor = unescape(queryMajor);

                $("#majorlist li a").each(function () {

                    var tempmajor1 = $(this).attr("majorid");

                    if (tempmajor1 == querymajor) {

                        $(this).click();

                    }
                });


                //发送请求
                table.reload('Teacherlist', {
                    url: '/Teaching/Teacher/GetTeacherByMajorOrGrand'
                    , where: {

                        majorid: querymajor,
                        grandid: 0,

                    } //设定异步数据接口的额外参数
                    //,height: 300
                });

            }
        });
    </script>

}



