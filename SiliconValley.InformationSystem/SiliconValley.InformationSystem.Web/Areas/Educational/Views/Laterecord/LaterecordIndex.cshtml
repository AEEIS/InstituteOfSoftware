
@{
    ViewBag.Title = "LaterecordIndex";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<table class="layui-table" id="Latercordtable"> </table>
<script type="text/html" id="Late_barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="ser">查看详情</a>
</script>

<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData">添加记录</button>
    </div>
</script>


<script>
    //table刷新
    function TableFulsh() {
        layui.use('table', function () {
            var table = layui.table;
            table.reload('Latercordtable');
        });
    }
    layui.use(['element', 'layer', 'form', 'laydate', 'table'], function () {
        var element = layui.element;
        var layer = layui.layer;
        var form = layui.form;
        var laydate = layui.laydate;
        var table = layui.table;
        //获取班级
        //form.on('select(Re_grand)', function (data) {
        //    $("#Re_class")[0].innerHTML = "";
        //    $.ajax({
        //        url: '/Educational/Reconcile/GetClassScheduleSelect/' + data.value,
        //        success: function (sudata) {
        //            //获取班级slect
        //            var classselect = $('<select id="class_select" name="class_select1" class="layui-select"><option value="0" selected>--请选择--</select>');
        //            for (var i = 0; i < sudata.length; i++) {
        //                $('<option value=' + sudata[i].id + '>' + sudata[i].ClassNumber + '<option>').appendTo(classselect);
        //            }
        //            $("#Re_class")[0].innerHTML = "";
        //            $("#Re_class").append(classselect);
        //            form.render(); //更新全部
        //        }
        //    });
        //});
        //时间初始化
        //laydate.render({
        //    elem: '#starTime'
        //    , theme: 'molv'
        //});

        //laydate.render({
        //    elem: '#endTime'
        //    , theme: 'molv'
        //});

        //laydate.render({
        //    elem: "#Time"
        //    , theme: 'molv'
        //});

        //laydate.render({
        //    elem: "#Time2"
        //    , theme: 'molv'
        //});

        //table初始化
        table.render({
            elem: '#Latercordtable'
            , toolbar: '#toolbarDemo'
            , url: '/Educational/Reconcile/GetTableData'
            , cols: [[
                { type: 'radio' }
                , { field: 'ClassNumber', title: '班级' }
                , { field: 'IsHavaHeadMaster', title: '班主任是否在场', }
                , { field: 'IsHavaTeacher', title: '任课老师是否在场' }
                , { field: 'IshavaPPT', title: '是否再讲PPT' }
                , { field: 'PersonCount', title: '应到人数' }
                , { field: 'PctualCout', title: '实到人数' }
                , {
                    field: 'Createdate', title: '上课日期', templet: function (res) {
                        var date = new Date(parseInt(res.Createdate.slice(6)));
                        var year = date.getFullYear();
                        var month = parseInt(date.getMonth()) + 1;
                        if (month < 10) {
                            month = "0" + month;
                        }
                        var days = date.getDate();
                        if (days<10) {
                            days = "0" + days;
                        }
                        return year + "-"+month + "-" + days;
                    }
                }
                , { field: 'EmpName', title: '录入人' }
                , { field: 'Reak', title: '说明' }
                , { fixed: 'right', title: '操作', toolbar: '#Late_barDemo', width: 150 }
            ]]
            , page: true
        });

        //监听行工具事件
        table.on('tool(Latercordtable)', function (obj) {
            var data = obj.data;
            if (obj.event === 'del') {
                layer.confirm('真的删除吗？', function (index) {
                    $.ajax({
                        url: '/Educational/Reconcile/Delete/' + data.Id,
                        success: function (sucdata) {
                            if (sucdata.Success == false) {
                                //失败
                                layer.msg('操作失败!!', { icon: 2 });
                            } else {
                                //成功
                                layer.msg(sucdata.Msg, { icon: 1, shade: 0.8 }, function () {
                                    TableFulsh();
                                });
                            }
                        }
                    });
                    layer.close(index);
                });

            } else if (obj.event === 'edit') {
                layer.open({
                    type: 2,
                    content: '/Educational/Reconcile/Edit_rView/' + data.Id,
                    area: ['800px', '500px'],
                    title: '编辑数据'
                    , shade: 0.8
                    , anim: 4
                    , skin: 'demo-class'
                });
            }
        });

       
        //form.on('submit(serch1)', function (data) {
        //    var class_select1 = data.field.class_select1;
        //    var starTime = data.field.starTime;
        //    var endTime = data.field.endTime;
        //    table.reload('Recon_table', {
        //        url: '/Educational/Reconcile/GetReconAllData'
        //        , where: { "class_select1": class_select1, "starTime": starTime, "endTime": endTime, "teachername": "", "Time2": "", "curr_select1": "" }
        //    });
        //    return false;
        //});
        //form.on('submit(serch3)', function (data) {
        //    var teachername = data.field.teachername;
        //    var Time2 = data.field.Time2;

        //    table.reload('Latercordtable', {
        //        url: '/Educational/Reconcile/GetReconAllData'
        //        , where: { "teachername": teachername, "Time2": Time2, "class_select1": "", "starTime": "", "endTime": "", "curr_select1": "" }
        //    });
        //    return false;
        //});
        

        //批量调课
        //头工具栏事件
        table.on('toolbar(Latercordtable)', function (obj) {
            var checkStatus = table.checkStatus(obj.config.id);
            switch (obj.event) {
                case 'getCheckData':
                    layer.open({
                        type: 2,
                        content: '/Educational/Reconcile/BigDataUpdate',
                        area: ['680px', '400px'],
                        title: '全体数据修改'
                        , shade: 0.8
                        , anim: 4
                        , skin: 'demo-class'
                    });
                    break;                
            };
        });

    });
</script>


