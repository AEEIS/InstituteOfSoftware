
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Index</h2>

<table id="emptab" lay-filter="test"></table>

@*头部工具栏*@
<script type="text/html" id="toolbarDemo">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="AddEmps">添加员工</button>
    </div>
</script>

@*操作栏*@
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>


@section script{

    <script>
        layui.use(['table', 'layer'], function () {
            var table = layui.table;
            var layer = layui.layer;
            table.render({
                elem: '#emptab'
                , url: '/Personnelmatters/EmployeesInfo/GetData'
                , id: "myEmpInfo"
                , toolbar: '#toolbarDemo'
                , limits: [1, 3, 6, 9, 12, 15, 18]
                , limit: 3
                , cols: [[
                    , { field: 'EmployeeId', title: '员工编号', width: 110, fixed: 'left' }
                    , { field: 'DDAppId', title: '钉钉工号', width: 110, sort: true, fixed: 'center' }
                    , { field: 'EmpName', title: '姓名', width: 110, sort: true, fixed: 'center' }
                    , { field: 'Depart', title: '所属部门', width: 110, sort: true, fixed: 'center' }
                    , { field: 'Position', title: '所属岗位', width: 110, sort: true, fixed: 'center' }
                    , { field: 'Sex', title: '性别', sort: true, width: 110, fixed: 'center', templet: '#mysex' }
                    , { field: 'Age', title: '年龄', sort: true, width: 110, fixed: 'center' }
                    , { field: 'Nation', title: '民族', sort: true, width: 110, fixed: 'center' }
                    , { field: 'Phone', title: '电话号码', sort: true, width: 110, fixed: 'center' }
                    , { field: 'IdCardNum', title: '身份证号码', sort: true, width: 110, fixed: 'center' }
                    , { field: 'EntryTime', title: '入职时间', sort: true, width: 110, fixed: 'center', templet: function (d) { return changeDateTimeFormat(d.EntryTime); } }
                    , { field: 'ContractStartTime', title: '合同起始时间', sort: true, width: 110, fixed: 'center', templet: function (d) { return changeDateTimeFormat(d.ContractStartTime); } }
                    , { field: 'ContractEndTime', title: '合同终止时间', sort: true, width: 110, fixed: 'center', templet: function (d) { return changeDateTimeFormat(d.ContractEndTime); } }
                    , { field: 'Birthdate', title: '出生日期', sort: true, width: 110, fixed: 'center', templet: function (d) { return changeDateTimeFormat(d.Birthdate); } }
                    , { field: 'Birthday', title: '生日', sort: true, width: 110, fixed: 'center' }
                    , { field: 'PositiveDate', title: '转正日期', sort: true, width: 110, fixed: 'center', templet: function (d) { return changeDateTimeFormat(d.PositiveDate); } }
                    , { field: 'UrgentPhone', title: '紧急联系电话', sort: true, width: 110, fixed: 'center' }
                    , { field: 'DomicileAddress', title: '户籍地址', sort: true, width: 110, fixed: 'center' }
                    , { field: 'Address', title: '现居地址', sort: true, width: 110, fixed: 'center' }
                    , { field: 'Education', title: '学历', sort: true, width: 110, fixed: 'center' }
                    , { field: 'MaritalStatus', title: '婚姻状态', sort: true, width: 110, fixed: 'center' }
                    , { field: 'IdCardIndate', title: '身份证有效期', sort: true, width: 110, fixed: 'center', templet: function (d) { return changeDateTimeFormat(d.IdCardIndate); } }
                    , { field: 'PoliticsStatus', title: '政治面貌', sort: true, width: 110, fixed: 'center' }
                    , { field: 'WorkExperience', title: '工作经验', sort: true, width: 110, fixed: 'center' }
                    , { field: 'ProbationSalary', title: '试用期工资', sort: true, width: 110, fixed: 'center' }
                    , { field: 'Salary', title: '转给工资', sort: true, width: 110, fixed: 'center' }
                    , { field: 'WorkingState', title: '在职状态', sort: true, width: 110, fixed: 'center' }
                    , { field: 'SSStartMonth', title: '社保起始月份', sort: true, width: 110, fixed: 'center' }
                    , { field: 'BCNum', title: '银行卡号', sort: true, width: 110, fixed: 'center' }
                    , { field: 'Material', title: '材料', sort: true, width: 110, fixed: 'center' }
                    , { field: 'Remark', title: '备注', sort: true, width: 110, fixed: 'center' }
                ]]
                , page: true
            });

            //头工具栏事件
            table.on('toolbar(test)', function (obj) {
                //var checkStatus = table.checkStatus(obj.config.id);
                switch (obj.event) {
                    case 'AddEmps':

                        AddEmployee();

                        break;
                };
            });

            //监听行工具事件
            table.on('tool(test)', function (obj) {
                var data = obj.data;
                //console.log(obj)
                if (obj.event === 'del') {
                    layer.confirm('真的删除行么', function (index) {
                        $.get("/EmployeesInfo/DelBill/" + data.id, function (da) {
                            if (da > 0) {
                                layer.alert("删除成功!", { icon: 1 }, function (index) {
                                    layui.use(['table'], function () {
                                        var table = layui.table;
                                        table.reload("myBill");
                                    });
                                    layer.close(index);
                                });
                            }
                            else {
                                layer.alert("删除失败!");
                            }
                        })
                    });
                }
                else if (obj.event === 'edit') {
                    addOrUpdate(data.id);
                }
            });
        });

        //添加员工的方法
        function AddEmployee() {
            layui.use(['layer'], function (args) {
                var layer = layui.layer;      //layui对象

                layer.open({
                    type: 2
                    , area: ["1200px", "700px"]
                    , title: "添加员工"
                    , content: '/Personnelmatters/EmployeesInfo/AddEmp'
                    , anim: 1
                });

            })

        }




        //格式化时间
        function changeDateTimeFormat(cellval) {
            if (cellval != null) {
                var date;
                if (cellval.indexOf("/Date(") >= 0) {
                    date = new Date(parseInt(cellval.replace("/Date(", "").replace(")/", ""), 10));
                }
                else {
                    date = new Date(cellval);
                }

                var month = date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1;
                var currentDate = date.getDate() < 10 ? "0" + date.getDate() : date.getDate();
                var hour = date.getHours() < 10 ? "0" + date.getHours() : date.getHours();
                var minute = date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes();
                var ss = date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds();

                return date.getFullYear() + "-" + month + "-" + currentDate + " " + hour + ":" + minute + ":" + ss;
            }
        }
    </script>
    <script type="text/html" id="mysex">
        {{# if(d.Sex==0){ }}
        {{ d.Sex="女" }}
        {{# }else{ }}
        {{ d.Sex="男" }}
        {{# } }}
    </script>

}
